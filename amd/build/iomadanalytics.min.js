define(["jquery","core/ajax","core/templates","/report/iomadanalytics/amd/src/Chart.min.js"],function(a,b,c,d){return{init:function(){a(document).ready(function(){function e(a,b){var c=document.getElementById(a);null!==c?new d(c.getContext("2d"),{type:"horizontalBar",data:b,options:{labels:{display:!1},legend:{display:!1},title:{display:!1},tooltips:{mode:"index",intersect:!1},responsive:!0,scales:{xAxes:[{stacked:!0,display:!1}],yAxes:[{stacked:!0,display:!1,barThickness:8}]}}}):console.log(a+" not found")}function f(){k(!0);var c=n(),d=[];d.push(a("#selectedFilter").val());var e=JSON.stringify({companies:c,filters:d}),f=b.call([{methodname:"report_iomadanalytics_filters",args:{filters:e}}]);f[0].done(function(b){i(d,c);var e=a.parseJSON(b);h(e.grades),g(e.progress),k(!1)}).fail(function(a){k(!1)})}function g(b){d.helpers.each(d.instances,function(a){var b=a.chart.canvas.id;b.includes("chart-progress-")===!0&&a.chart.destroy()}),a("#progressGraph").html("");for(t in b.datasets.companies)r="chart-progress-"+b.datasets.companies[t].id,a("#progressGraph").append('<div class="col-md-4"><canvas id="'+r+'"></canvas></div>'),new d(document.getElementById(r).getContext("2d"),{type:"pie",data:b.datasets.companies[t].graph,options:{legend:!1,title:{text:b.datasets.companies[t].company,display:!0,position:"bottom"},tooltips:{enabled:!0,mode:"single",callbacks:{label:function(a,b){return b.labels[a.index].replace("&nbsp;"," ")+" : "+b.datasets[a.datasetIndex].data[a.index]+"%"}}}}})}function h(a){null!==q&&q.destroy(),q=new d(document.getElementById("chart-grades").getContext("2d"),{type:"bar",data:a,options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]},tooltips:{enabled:!0,mode:"single",callbacks:{label:function(a,b){return b.datasets[a.datasetIndex].label+" : "+a.yLabel+"%"}}}}})}function i(b,d){var e="";e="all"==a("#selectedFilter").val()?"None":a("<div>").html(a("button[data-filterid='"+b+"'").html()).text(),c.render("report_iomadanalytics/filter_selection_details",{filter:e,CompanyList:m(d)}).then(function(a,b){c.replaceNodeContents(".filterSelectionDetails",a,b)}).fail(function(a){console.log(a)})}function j(b){console.log("input#"+b),a("input#"+b).click(function(){a(".country-"+b+" input").prop("checked",a(this).prop("checked")),f()})}function k(b){s.hasClass("view_stats_company")===!0&&a(".country_company input, .country input").attr("disabled",!0),s.hasClass("view_stats_country")===!0&&(a(".country input").attr("disabled",!0),a(".country_company input").attr("disabled",b)),s.hasClass("view_stats_all")===!0&&a(".country_company input, .country input").attr("disabled",b),a("#filters_tab button").attr("disabled",b)}function l(){a("#filters_tab button").each(function(){a(this).html(a("<div>").html(a(this).html()).text()).removeClass("bkgBtn")})}function m(b){var c=[];return a.each(b,function(d){c.push(a("#"+b[d]).val())}),c.join(", ").toUpperCase()}function n(){var b=[];return a(".country_company input").each(function(){this.checked&&b.push(a(this).attr("id"))}),b}for(var o=["ID","MY"],p="/report/iomadanalytics/templates/",q=null,r="",s=a("body"),t=0;t<o.length;t++)console.log(o[t]),j(o[t]);a(".country_company input").change(function(){f()}),s.hasClass("view_stats_all")&&(a.getJSON(p+"systemoverview_rendered.json",function(a){for(var b in o)for(var c in a[o[b]]){var d="chart-"+c+"-"+o[b],f=a[o[b]][c];e(d,f)}}),a.getJSON(p+"allCtryProgressYearBlock.json",function(a){new d(document.getElementById("chart-progressyear").getContext("2d"),a)})),f(),a("#filters_tab button").click(function(){a("#selectedFilter").val(a(this).data("filterid")),l(),a(this).html('<i class="fa fa-check"></i> '+a(this).html()).addClass("bkgBtn"),f()}),a("div.bhoechie-tab-menu>div.list-group>a").click(function(b){b.preventDefault(),a(this).siblings("a.active").removeClass("active"),a(this).addClass("active");var c=a(this).index();a("div.bhoechie-tab>div.bhoechie-tab-content").removeClass("active"),a("div.bhoechie-tab>div.bhoechie-tab-content").eq(c).addClass("active")})})}}});